明白，这个需求变更非常关键。这意味着页面不再是一个单纯的“聊天窗口”，而更像是一个**“左侧指令控制台 + 右侧智能多媒体看板”**的协作工作台。

由于AI返回的多媒体文件数量多，我们将采用**“文资分离” (Text-Asset Separation)** 的设计模式。

以下是修改后的前端设计文档，专门适配“高密度多媒体展示”场景。

---

# 前端设计文档：企业级多媒体智能工作台 (Enterprise AI Multimedia Workspace)

## 1. 设计核心理念
*   **文资分离 (Text-Asset Separation):**
    *   **左侧 (Chat Console):** 仅展示纯文本对话流，保持指令清晰，无视觉干扰。
    *   **右侧 (Media Gallery):** 专门展示 AI 返回的海量多媒体资源（网格/列表布局），是视觉重心。
*   **深层预览 (Deep Preview):** 支持 Office、PDF、PSD、视频等多种格式的在线查看。
*   **引用闭环:** 从右侧资源库中选择文件 -> 抛回左侧输入框 -> 进行针对性问答。

## 2. 页面布局 (Split-Screen Layout)

采用 **可调节宽度的双栏布局**：

*   **左侧：对话控制台 (Chat Console) - 默认占比 30%-40%**
    *   包含：历史消息流（纯文字）、底部输入框。
    *   视觉：类似代码编辑器或终端的侧边栏，简洁紧凑。
*   **右侧：多媒体画廊 (Media Gallery) - 默认占比 60%-70%**
    *   **视图 A (资源网格):** 默认视图。展示当前对话关联的所有文件（缩略图形式）。
    *   **视图 B (沉浸预览):** 当点击某个文件时，覆盖或模态展示文件的详情（预览器）。

## 3. 详细组件设计

### 3.1 左侧：对话控制台 (Chat Area)
*   **消息流:**
    *   **AI Message:** 仅渲染 Markdown 文本。如果有附件，文本末尾可以加一个小提示（例如：“已生成 8 个相关文件，请在右侧查看”），或者在文本中高亮关键词链接到右侧。
*   **输入框 (Input Context):**
    *   **引用挂载:** 当用户从右侧选择了文件，输入框上方出现 `[引用文件: 由于文件多.pdf]` 的胶囊标签。
    *   **多文件支持:** 支持同时引用多个右侧文件进行对比提问。

### 3.2 右侧：多媒体画廊 (Media Gallery / Dashboard)
*   **分组展示:** AI 每次回答可能生成一批文件。建议按“对话轮次”或“文件类型”进行分组显示。例如：
    *   *Header:* "Answer to: 'Show me the Q3 Report'"
    *   *Grid:* 视频 x1, PDF x2, 图片 x10。
*   **卡片设计 (Asset Card):**
    *   **图片:** 显示缩略图 + 文件名。
    *   **非图片:** 显示文件类型图标 + 文件名 + 大小。
    *   **操作:** Hover 时显示“预览”、“引用(Ask AI)”、“下载”。

### 3.3 核心功能：统一文件预览器 (Universal Previewer)
这是本页面的技术难点，建议封装一个 `FilePreviewer` 组件，根据扩展名分发渲染逻辑：

*   **Image (jpg, png, webp):** 使用 `<img />` + `react-zoom-pan-pinch` (支持滚轮缩放、拖拽查看细节)。
*   **Video (mp4, webm):** 使用 HTML5 Video 或 `react-player`。
*   **PDF:** 使用 `react-pdf` (Mozilla PDF.js 的 React 封装)。
*   **Office (docx, pptx, xlsx):**
    *   *方案 A (推荐内网/低成本):* 使用 `react-doc-viewer`。它支持多种渲染器（包括 Google/Microsoft 的公开 API iframe 嵌入）。
    *   *方案 B (纯前端解析):* `xlsx` 库解析 Excel，`mammoth.js` 解析 Word (仅文本)。**PPT 纯前端渲染非常难**，建议后端转 PDF 或图片流给前端，或使用方案 A。
*   **PSD (Photoshop):** 使用 `ag-psd` 库与 `canvas` 结合，可以在前端直接解析并渲染 PSD 的缩略图或图层。

## 4. 数据结构定义 (TypeScript Interface)

```typescript
// 资源类型枚举
type MediaType = 'image' | 'video' | 'pdf' | 'word' | 'ppt' | 'excel' | 'psd' | 'unknown';

// 资源对象
interface MediaAsset {
  id: string;
  filename: string;
  url: string; // 预览地址
  downloadUrl?: string; // 原始文件下载地址
  type: MediaType;
  mimeType: string;
  metadata?: {
    width?: number;
    height?: number;
    duration?: number; // 视频时长
    pageCount?: number; // PDF/PPT 页数
  };
  relatedMessageId: string; // 关联哪一条 AI 回复
}

// 消息对象
interface Message {
  id: string;
  role: 'user' | 'assistant';
  text: string; // 纯文本
  timestamp: number;
}

// 全局状态 (Store)
interface WorkspaceState {
  chatHistory: Message[];
  mediaAssets: MediaAsset[]; // 所有返回的资源扁平化列表，或者按消息ID分组的Map
  selectedAssetId: string | null; // 当前正在大图预览的资源
  contextFiles: MediaAsset[]; // 当前输入框引用的文件列表
}
```

## 5. 交互流程 (User Flow)

1.  **提问与生成:**
    *   用户在左侧提问：“把上个季度的宣传物料和财报发给我。”
    *   左侧：AI 流式输出文字：“好的，这是为您找到的 12 个文件...”
    *   右侧：**实时出现** 加载骨架屏，随后刷出 12 个文件卡片（包含 PSD 海报、MP4 视频、PDF 财报）。
2.  **浏览与预览:**
    *   用户觉得右侧的图片太小，点击一张 PSD 海报。
    *   触发 **模态框(Modal)** 或 **右侧全屏覆盖**。
    *   预览器加载 `ag-psd`，用户查看海报细节。
3.  **引用追问:**
    *   用户发现 PDF 财报有问题。
    *   在右侧列表中找到该 PDF，点击“引用”图标（或在预览界面点击“对此提问”）。
    *   该 PDF 自动飞入左侧输入框变成一个 Tag。
    *   用户输入：“这个文件的第 3 页数据为什么是红色的？”
    *   发送。

## 6. 技术选型建议 (Library Recommendations)

为了实现特定格式的预览，请在生成代码时指定安装以下库：

*   **UI 框架:** `Tailwind CSS`, `Shadcn/UI` (Resizable Panel 组件非常适合做这种左右拖拽布局)。
*   **PDF 预览:** `react-pdf`
*   **Office 文档:** `react-doc-viewer` (注意：这通常依赖公网 API，如果是内网环境，需后端配合转码)。
*   **PSD 解析:** `ag-psd` (前端解析 PSD 的最佳选择)。
*   **图片查看:** `react-medium-image-zoom` 或 `yet-another-react-lightbox` (提供专业的画廊体验)。
*   **图标:** `lucide-react` (文件类型图标丰富)。

---

## 7. 给 AI 的 Prompt (直接复制用)

你可以将下面这段话发送给 Cursor/v0：

> "请帮我构建一个**'对话 + 多媒体仪表盘'**风格的 Web 应用。
>
> **布局要求：**
> 使用 Resizable Split Pane（可拖拽分割面板）。
> - **左侧 (30%)：** 纯文本对话区域。类似 IDE 的终端窗口，显示用户和 AI 的文字对话。底部是输入框。
> - **右侧 (70%)：** 多媒体资源网格 (Media Gallery)。这里显示 AI 返回的所有文件。
>
> **核心逻辑：**
> 1.  当 AI 返回消息时，文字流在左侧显示。如果回答包含文件，这些文件**不显示在左侧气泡里**，而是直接追加渲染到**右侧的网格区域**。
> 2.  **右侧文件卡片**：需要根据文件类型（Video, Image, PDF, PPT, Word, PSD）显示不同的图标或缩略图。
> 3.  **预览功能**：点击右侧文件，弹出一个全屏 Modal 进行预览。
>     - 图片使用 Lightbox 效果。
>     - 视频使用 Video Player。
>     - 其他文件（PDF/Office）先显示一个 placeholder 区域表示 'Previewer Area'。
> 4.  **Chat with File**：在右侧文件卡片上有一个 'Ask AI' 按钮。点击后，该文件被添加到左侧输入框的 Context 列表中（UI 上显示为可删除的 Tag），用于后续对话。
>
> **技术栈：**
> React, Tailwind CSS, Lucide Icons, Shadcn/UI (Card, ScrollArea, Dialog, Resizable)。
>
> 请先写出 TypeScript 接口定义，特别是如何将左侧的消息 ID 与右侧的资源关联起来。"